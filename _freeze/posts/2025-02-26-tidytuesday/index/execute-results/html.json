{
  "hash": "6c522f6dfb04147ebadee8e3a249cf46",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"TidyTuesday: Racial disparities in reproductive research\"\ndescription: \"\"\nauthor:\n  - name: Jess Graves\ndate: 02-26-2025\nformat:\n  html:\n    toc: true\n    toc-depth: 4\n    toc-expand: 2\n    embed-resources: true\n    code-fold: true\n    code-tools: true\neditor: visual\nexecute-dir: project\ncrossref:\n  fig-title: '**Figure**'\n  tbl-title: '**Table**'\n  fig-labels: arabic\n  tbl-labels: arabic\n  title-delim: \".\"\nlink-citations: true\nexecute:\n  echo: true\n  warning: false\n  message: false\ncategories: [tidy tuesday, data visualization] # self-defined categories\nimage: preview-image.png\ndraft: false  \n# bibliography: references.bib\nnocite: |\n  @*\n# csl: statistics-in-biosciences.csl\nbibliographystyle: apa\ncitation: true\n---\n\n\n\n# This week's dataset (2025-02-25)\n\nThis week's tidytuesday included a published dataset from review article [Racial and ethnic disparities in reproductive medicine in the United States: a narrative review of contemporary high-quality evidence](https://www.ajog.org/article/S0002-9378(24)00775-0/fulltext) published in the *American Journal of Obstetrics and Gynecology* in January 2025. Here's what their [README](https://github.com/rfordatascience/tidytuesday/tree/main/data/2025/2025-02-25) says:\n\n::: {.callout-note appearance=\"minimal\"}\nThis week we're exploring data on studies investigating racial and ethnic disparities in reproductive medicine as published in the eight highest impact peer-reviewed Ob/Gyn journals from January 1, 2010 through June 30, 2023. The data were collected as part of a review article [Racial and ethnic disparities in reproductive medicine in the United States: a narrative review of contemporary high-quality evidence](https://www.ajog.org/article/S0002-9378(24)00775-0/fulltext) published in the *American Journal of Obstetrics and Gynecology* in January 2025.\n\n> \"There has been increasing debate around how or if race and ethnicity should be used in medical research—including the conceptualization of race as a biological entity, a social construct, or a proxy for racism. The objectives of this narrative review are to identify and synthesize reported racial and ethnic inequalities in obstetrics and gynecology (ob/gyn) and develop informed recommendations for racial and ethnic inequity research in ob/gyn.\"\n:::\n\n## What I hope to visualize\n\nWe know already that science has historically failed to enroll representative groups. And so, with this data I wanted to explore two things:\n\n-   Are there differences in representation in racial groups across study types – that is, are we more likely to get better representation in cohort studies or clinical trials?\n\n-   Are there changes in the magnitude of representation over time – have we seen improvements in cohort representatives over the years?\n\n# Data\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Libraries\"}\nlibrary(tidytuesdayR)\nlibrary(tidyverse)\nlibrary(renv)\nlibrary(styler)\nlibrary(ggridges)\nlibrary(colorspace)\nlibrary(wesanderson)\nlibrary(patchwork)\n\n# setting ggplot theme\nmy_theme <- theme_classic() +\n  theme(\n    axis.title = element_text(size = 16, color = \"white\"),\n    axis.text = element_text(size = 14, color = \"grey90\"),\n    axis.line = element_line(color = \"grey90\"),\n    strip.text = element_text(size = 14),\n    plot.background = element_rect(\n      color = \"grey30\",\n      fill = \"grey30\"\n    ),\n    panel.background = element_rect(\n      color = \"grey30\",\n      fill = \"grey30\"\n    )\n  )\n\ntheme_set(my_theme)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Reading in dataset & cleaning\"}\narticle_dat <- read_csv('data/article_dat.csv') %>%\n  # combining month, day, year into date data\n  mutate(date = make_date(year, month, day), \n  # calculate total number of groups represented\n  n_races = rowSums(!is.na(select(., c(contains('race'), \n                                              -contains('_ss')))), \n                                  na.rm = TRUE), \n  # n_ethnicity = rowSums(!is.na(select(., c(contains('eth'), \n  #                                             -contains('_ss')))), \n  #                                 na.rm = TRUE), \n  # cleaning sudy type data\n  study_type = factor(if_else(study_type=='RCT', \n                       study_type, \n                       str_to_sentence(study_type)), \n                      levels = c('Cross-sectional', \n                                 'Registry', \n                                 'Case-control', \n                                 'Retrospective cohort', \n                                 'Prospective cohort', \n                                 'RCT'))) %>%\n  # dropping any without study data or no race information\n  filter(!is.na(study_type), \n         n_races > 0)\n\n# setting color palette based on number of study types\nstudy_pal <- wes_palette(name='Zissou1', \n                         n=length(unique(article_dat$study_type)), \n                         type='continuous')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Quick glance at data\"}\narticle_dat %>%\n  dplyr::select(date, contains(\"race\")) %>%\n  head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 18\n  date       race1   race1_ss race2 race2_ss race3 race3_ss race4 race4_ss race5\n  <date>     <chr>      <dbl> <chr>    <dbl> <chr>    <dbl> <chr>    <dbl> <chr>\n1 2020-04-03 Black …      332 White      157 Hisp…       70 Asian        6 Other\n2 2019-11-05 White …     1058 Amer…       37 Asian      228 Blac…       80 Hisp…\n3 2019-07-05 Black         40 Hisp…      166 Non-…      144 Othe…       17 <NA> \n4 2018-07-10 Non-Hi…      855 Non-…       28 Asian       43 Hisp…       34 <NA> \n5 2018-07-10 White      78184 Black     8518 <NA>        NA <NA>        NA <NA> \n6 2017-05-29 White        -99 Black      -99 Amer…      -99 Asia…      -99 <NA> \n# ℹ 8 more variables: race5_ss <dbl>, race6 <chr>, race6_ss <dbl>, race7 <chr>,\n#   race7_ss <dbl>, race8 <chr>, race8_ss <dbl>, n_races <dbl>\n```\n\n\n:::\n:::\n\n\n\n# Making panels for figure\n\nI'm going to be using:\n\n-   `geom_density_ridges()` from the {[`ggridges`](https://cran.r-project.org/web/packages/ggridges/vignettes/introduction.html)} library to visualize the distribution of representation across study types\n\n-   `geom_area()` from the {[`ggplot2`](https://ggplot2.tidyverse.org/reference/geom_ribbon.html)} library to visualizes changes in numbers of publications and representation over time and study types\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Panel 1 figure\"}\n# setting ridge overlap\nridge_overlap <- 2\n\np1 <- article_dat %>%\n  ggplot(aes(x=n_races, y=study_type, fill=study_type)) + \n  geom_density_ridges(alpha=0.9, \n                      scale=ridge_overlap, \n                      color = 'grey50') + \n  scale_fill_manual(values=study_pal) + \n  labs(y='', \n       x='Racial groups') + \n  theme(legend.position = 'none',\n        axis.line.y = element_blank(), \n        axis.ticks = element_blank(), \n        axis.text.y = element_text(vjust=-0.25, \n                                   color = \"white\")\n        )+ \n  scale_x_continuous(breaks=seq(0, 10, by=2), \n                     limits=c(0, 10), \n                     expand=c(0, 0.5))  +\n  scale_y_discrete(expand = c(0.00, 0))\n\n# Calculating % that have > 2 racial groups in their studies\nsum_dat <- article_dat %>%\n  group_by(study_type) %>% \n  summarize(n_more_2=sum(n_races >2), \n            total = n(), \n            pct=paste0(round(100*n_more_2/total), '%')) %>%\n  mutate(x=rep(9, times=6))\n  \n# adding to figure \np1 <- p1 + geom_text(data=sum_dat, \n               mapping = aes(x=x, \n                             y=study_type, \n                             label = pct), \n               inherit.aes=F, \n               color ='white', \n               vjust=-2, \n               fontface = 'bold'\n               )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Panel 2 figure\"}\np2 <- article_dat %>%\n  group_by(study_type, year) %>%\n  tally() %>%\n  mutate(\n    year_mo = make_date(year), \n    study_type = factor(study_type, levels = rev(levels(article_dat$study_type)))) %>%\n  ggplot(aes(x=year_mo, y = n, fill = study_type, color = study_type)) + \n  geom_area(alpha = 0.9, position = \"stack\") +\n  theme(\n    legend.position = \"none\",\n    axis.text.x = element_blank(),\n    axis.line.x = element_blank(),\n    axis.title.x=element_blank(),\n    strip.placement = \"outside\",\n    axis.ticks = element_blank(),\n    plot.margin = margin(1, 0, 0, 0.5, \"cm\")\n  ) +\n  labs(\n    x = \"Year\", y = \"\\nPublications\",\n    color = \"\", fill = \"\"\n  ) +\n  scale_fill_manual(values = rev(study_pal)) +\n  scale_color_manual(values = rev(study_pal)) +\n  scale_x_date(\n    date_breaks = \"1 years\",\n    date_labels = \"%Y\",\n    expand = c(0, 0),\n    limits = c(\n      as.Date(\"2010-01-01\"),\n      as.Date(\"2023-12-31\")\n    )\n  ) +\n  guides(fill = guide_legend(ncol = 3))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Panel 3 figure\"}\np3 <- article_dat %>%\n  mutate(study_type = factor(study_type, levels = rev(levels(article_dat$study_type)))) %>%\n  ggplot(aes(\n    x = date,\n    y = n_races,\n    fill = study_type\n  )) +\n  geom_area(alpha = 0.9, position = \"stack\") +\n  theme(\n    legend.position = \"none\",\n    axis.text.x = element_text(angle = 45, hjust = 1),\n    strip.placement = \"outside\",\n    axis.ticks = element_blank(),\n    plot.margin = margin(1, 0, 0, 0.5, \"cm\")\n  ) +\n  labs(\n    x = \"Year\", y = \"\\nRacial groups\\nin the study\",\n    color = \"\", fill = \"\"\n  ) +\n  scale_fill_manual(values = rev(study_pal)) +\n  scale_color_manual(values = rev(study_pal)) +\n  scale_y_continuous(\n    breaks = seq(0, 30, by = 5),\n    expand = c(0, 0),\n    limits = c(0, 30)\n  ) +\n  scale_x_date(\n    date_breaks = \"1 years\",\n    date_labels = \"%Y\",\n    expand = c(0, 0),\n    limits = c(\n      as.Date(\"2010-01-01\"),\n      as.Date(\"2023-12-31\")\n    )\n  ) +\n  guides(fill = guide_legend(ncol = 3))\n```\n:::\n\n\n\n# Combining for final figure\n\nLibrary {[`patchwork`](https://patchwork.data-imaginist.com)} comes in handy here!\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfig <- (p1 | (p2/p3)) +\n  plot_annotation(\n    title = \"Trends in research on racial disparities in reproductive health\",\n    caption = \"\\nData from 'Racial and ethnic disparities in reproductive medicine in the United States: a narrative review of contemporary high-quality evidence'\\npublished in the American Journal of Obstetrics and Gynecology in January 2025.\",\n    theme = list(\n      plot.title = element_text(size = 20, face = \"bold\", color = \"white\"),\n      plot.caption = element_text(color = \"white\")\n    )\n  ) +\n  plot_layout(\n    widths = c(0.75, 2.5)\n  )\n```\n:::\n\n\n\nMaking some labels to annotate the text – I recently learned about `inset_element()` from the {patchwork} library – nice for adding text to a already patchworked figure.\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Making annotations for plot\"}\nlabel1 <- ggplot() + \n  annotate(\"text\", \n           x = 1, \n           y = 5,\n           size=4,\n           fontface = 'bold',\n           label = \"Studies w/ >2\\nracial groups\", \n           hjust=0,\n           color = 'white', \n           ) +\n  coord_cartesian(clip = \"off\") +  \n  theme_void()\n\nlabel2 <- ggplot() + \n  annotate(\"text\", \n           x = 1, \n           y = 5,\n           size=4,\n           fontface = 'bold',\n           label = \"An increasing number of studies on racial disparities\\nin reprouctive health are being done, most of which\\nare in retrospective cohort studies.\", \n           hjust=0,\n           color = 'white', \n           ) +\n  coord_cartesian(clip = \"off\") +  \n  theme_void()\n\nlabel3 <- ggplot() + \n  annotate(\"text\", \n           x = 1, \n           y = 5,\n           size=4,\n           fontface = 'bold',\n           label = \"Case-control and RCTs consistently have\\nthe fewestracial groups represented.\", \n           hjust=0,\n           color = 'white', \n           ) +\n  coord_cartesian(clip = \"off\") +  \n  theme_void()\n\n# adding labels\nfinal_fig <- fig + \n  inset_element(label1,\n                left = -0.31,\n                top = 0.87,\n                bottom = 0.87,\n                right = -0.31) +\n  inset_element(label2, \n                left = 0.01, \n                top = 1, \n                bottom = 0.9, \n                right = 0.01) + \n  inset_element(label3, \n                left = 0.01, \n                top = 0.45, \n                bottom = 0.4, \n                right = 0.01) \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfinal_fig\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=1344}\n:::\n:::\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}